      if (jsonMatch) {
          cleanResponse = jsonMatch[1];
      }
      
      const detection = JSON.parse(cleanResponse);
      console.log("Parsed detection:", detection);
      
      contactConfidence = detection.confidence || "low";
      contactReason = detection.reason || "";
      
      // Only trigger contact request if confidence is high or medium
      isContactRequest = detection.wantsContact === true && (contactConfidence === "high" || contactConfidence === "medium");
      console.log("Is contact request:", isContactRequest, "Confidence:", contactConfidence, "Reason:", contactReason);
    } catch (e) {
      console.error("Failed to detect contact request with AI:", e);
    }

    // 2. If contact request detected with sufficient confidence, handle it immediately and return
// ... keep existing code
