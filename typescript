import { useState } from "react";
import { useMutation } from "convex/react";
import { useAuth } from "@/hooks/use-auth";
import { api } from "@/convex/_generated/api";
import { Id, Doc } from "@/convex/_generated/dataModel";

// ... keep existing code
  const [viewColdCallerLeads, setViewColdCallerLeads] = useState(false);

  const allTags = useQuery(api.tags.getAllTags) || [];
  const uniqueSources = useQuery(api.leadQueries.getUniqueSources) || [];
  const allUsers = useQuery(api.users.getAllUsers, user ? { userId: user._id } : "skip") || [];

  const leadsWithoutFollowUp = useQuery(
    api.leads.queries.getMyLeadsWithoutFollowUp,
    user && filter === "mine" ? { userId: user._id } : "skip"
  );
  
  const hasMandatoryFollowUps = leadsWithoutFollowUp && leadsWithoutFollowUp.length > 0;
  const isLoadingMandatory = leadsWithoutFollowUp === undefined;

  const assignLead = useMutation(api.leads.standard.assignLead);
  const coldCallerLeadsNeedingFollowUp = useQuery(
    api.coldCallerLeads.getColdCallerLeadsNeedingFollowUp,
    user ? {} : "skip"
  ) || [];

  return (
    <AppLayout>
      {/* Show reminders first, then mandatory follow-up popup */}
      {filter === "mine" && !isLoadingMandatory && !hasMandatoryFollowUps && <LeadReminders />}
      {filter === "mine" && hasMandatoryFollowUps && <MandatoryFollowUpPopup leads={leadsWithoutFollowUp} />}
      
      <div className="h-[calc(100vh-4rem)] flex flex-col gap-4">
      // ... keep existing code
    </AppLayout>
  );
}

export function MandatoryFollowUpPopup({ leads }: MandatoryFollowUpPopupProps) {
  // ... new implementation
}